<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial 3: 2D flow model over sloped terrain with multiple rasters &mdash; 3Di  (dev doc 2023-04-03) documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/matomo.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial 4 Building a 2D flow model with levees, channels and breaches" href="e_2d_levees_tutorial.html" />
    <link rel="prev" title="Tutorial 2: Building a Basic 2D Flow Schematisation" href="e_2d_tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            3Di
          </a>
              <div class="version">
                 (dev doc 2023-04-03)
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="a_background.html">Background of 3Di</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_ecosystem.html">3Di Ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_releasenotes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_contact.html">Contact</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modelling Guidelines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="a_modelling_concepts.html">Basic Modelling Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="b_modeling_components.html">Modeling components</a></li>
<li class="toctree-l1"><a class="reference internal" href="b_modelling_workflow.html">Modelling Workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide to the 3Di Modeller Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="i_what_is_mi.html">What is the Modeller Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="i_overview_user_interface.html">Overview of the Modeller Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="i_overview_user_interface.html#overview-plugins">Overview plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="i_modelling_with_mi.html">Modelling with the Modeller Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide to the 3Di Live Site</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="c_what_is_the_live_site.html">What is the Live Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_livesite_overview.html">Overview of the Live Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_modelling_with_live_site.html">Modelling with the Live Site</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide to the 3Di Management Portal</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="d_management.html">What is the Management Portal</a></li>
<li class="toctree-l1"><a class="reference internal" href="d_management.html#overview-management-portal">Overview management portal</a></li>
<li class="toctree-l1"><a class="reference internal" href="d_overview_management_portal.html">How to use the Management Portal</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">3Di for developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="j_api.html">3Di API</a></li>
<li class="toctree-l1"><a class="reference internal" href="j_threedigrid.html">3Di Results API</a></li>
<li class="toctree-l1"><a class="reference internal" href="j_fews_3di_integrations.html">FEWS-3Di integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="j_lizard_api.html">Lizard API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="e_klondike_workflow.html">Tutorial 1: Workflow of creating a 3Di Schematisation and a 3Di Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_2d_tutorial.html">Tutorial 2: Building a Basic 2D Flow Schematisation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial 3: 2D flow model over sloped terrain with multiple rasters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#model-initialisation">Model initialisation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#model-preparation">Model preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-the-model-in-the-3di-modeller-interface">Loading the model in the 3Di Modeller Interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-building">Model building</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#set-the-model-name">Set the model name</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-rasters-to-the-model">Add rasters to the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modify-the-settings-for-mountain-environments">Modify the settings for mountain environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#complete-the-location-specific-settings">Complete the location-specific settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-validation">Model validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verify-the-model-rasters-using-the-raster-checker">Verify the model rasters using the raster checker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verify-the-schematisation-using-the-schematisation-checker">Verify the schematisation using the schematisation checker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-activation">Model activation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#upload-your-model">Upload your model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-your-model">Run your model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="e_2d_levees_tutorial.html">Tutorial 4 Building a 2D flow model with levees, channels and breaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_1d_tutorial.html">Tutorial 5: Building a 1D model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Problem solving and support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="f_3di_instruments_and_downloads.html">Installation manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="f_authentication_user_management.html">Authentication and User Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="f_problem_solving.html">FAQ and Problem Solving</a></li>
<li class="toctree-l1"><a class="reference internal" href="f_servicedesk.html">Servicedesk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="g_massconservation.html">Conservation of mass</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_sources_sinks.html">Source and Sink terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_levees_obstacles_breaches.html">Obstacles, Levees and Breaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_wind.html">Wind effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_interception.html">Interception</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="h_basic_modelling_concepts_threedi.html">Basic Modelling Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_grid.html">The grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_numerics.html">Numerics</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_control.html">Control Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_calculation_grid_data.html">Tabulated data storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_results.html">Results 3Di</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_aggregate_results.html">Aggregated output</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_state_files.html">State files</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Overig</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="d_scenario_archive.html">Scenario Archive</a></li>
<li class="toctree-l1"><a class="reference internal" href="d_scenario_archive.html#view-stored-results">View stored results</a></li>
<li class="toctree-l1"><a class="reference internal" href="d_scenario_archive.html#damage-estimation">Damage Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="d_scenario_archive.html#load-rasters-in-3di-modeller-interface-using-wms">Load rasters in 3Di Modeller Interface using WMS</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">3Di</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorial 3: 2D flow model over sloped terrain with multiple rasters</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/e_2d_slope_tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial-3-2d-flow-model-over-sloped-terrain-with-multiple-rasters">
<span id="tutorial3-2dflowmodel"></span><h1>Tutorial 3: 2D flow model over sloped terrain with multiple rasters<a class="headerlink" href="#tutorial-3-2d-flow-model-over-sloped-terrain-with-multiple-rasters" title="Permalink to this heading"></a></h1>
<p>In this tutorial, we will build a basic 2D flow model in mountainous terrain using 3Di. We will edit an existing sqlite, and this tutorial will introduce friction and infiltration rasters.
These rasters have been highly simplified for the purpose of this tutorial.
As with any other component of the tutorials, the data and outcomes cannot be used to draw conclusions of the real-world location that was the inspiration for this tutorial.
At the end of this tutorial, you will have a basic working model that you can run on the 3Di live site.</p>
<p>The selected area is that of Lake Mead in the USA.
The lake is enclosed between the mountains of Nevada, Utah, and Arizona.
The area contains strong elevation differences and steep slopes, which changes the hydrodynamics.
Specifically, the standard assumption that the variation in water level is much smaller than the variation in bed level does not hold in this terrain.
Therefore, different settings are required, which will be explored in this tutorial.</p>
<p>You will learn the following skills in this tutorial:</p>
<ul class="simple">
<li><p>Edit an existing .sqlite from the model database.</p></li>
<li><p>Insight in the relevant settings for sloping terrain.</p></li>
<li><p>Couple a friction raster to your 3Di-model.</p></li>
<li><p>Couple an infiltration raster to your 3Di-model.</p></li>
</ul>
<p>Before you start, please make sure to:</p>
<ul class="simple">
<li><p>Install the 3Di Modeller Interface. Please see <a class="reference internal" href="f_3di_instruments_and_downloads.html#di-instruments-and-downloads"><span class="std std-ref">Installation manual</span></a> for instructions.</p></li>
<li><p>Install the 3Di toolbox in the Modeller Interface. Please see <a class="reference internal" href="f_3di_instruments_and_downloads.html#plugin-installation"><span class="std std-ref">Plugin Installation</span></a> for instructions.</p></li>
<li><p>Gain access to the 3Di web portal. Please see the <a class="reference internal" href="c_what_is_the_live_site.html#guide-to-portal"><span class="std std-ref">Technical setup</span></a> for instructions.</p></li>
<li><p>Download the starter pack for this tutorial, which includes a partially completed .sqlite-database and rasters (DEM, friction, infiltration, infiltration capacity) for Lake Mead <a class="reference external" href="https://nens.lizard.net/media/3di-tutorials/3di-tutorial-02.zip">here</a>.</p></li>
</ul>
<section id="model-initialisation">
<h2>Model initialisation<a class="headerlink" href="#model-initialisation" title="Permalink to this heading"></a></h2>
<section id="model-preparation">
<h3>Model preparation<a class="headerlink" href="#model-preparation" title="Permalink to this heading"></a></h3>
<p>Unpack the starter package and save the contents into a folder.
You should have a partially configured .sqlite, and a folder named “raster”.
The raster folder contains a DEM, a friction map, an infiltration map, and an infiltration capacity map.
The partially configured .sqlite already has all the mandatory settings.</p>
<figure class="align-default">
<img alt="The base files" src="_images/01_basefiles.png" />
</figure>
</section>
<section id="loading-the-model-in-the-3di-modeller-interface">
<h3>Loading the model in the 3Di Modeller Interface<a class="headerlink" href="#loading-the-model-in-the-3di-modeller-interface" title="Permalink to this heading"></a></h3>
<p>Our model must be imported in the 3Di Modeller Interface to view and modify its contents.
The model can be loaded via the 3Di toolbar (part of the 3Di toolbox plug in) by following these steps:</p>
<ol class="upperalpha simple">
<li><p>Open the 3Di Modeller Interface.</p></li>
<li><p>Create a new project.</p></li>
<li><p>In the figure below; Select the <strong>select 3Di results</strong> button on the 3Di Toolbar (white database icon). [1]</p></li>
<li><p>Select <strong>load</strong> in the model section, and select the Lake_Mead.sqlite database provided with this tutorial. The load button may not be visible on all screens and zoom settings. It can help to enlarge the pop-up window. [2]</p></li>
<li><p>You should now see the 3Di model as part of your Modeller Interface layers. [3]</p></li>
</ol>
<figure class="align-default">
<img alt="Load model" src="_images/02_load_model.png" />
</figure>
<p>Now load the rasters into Modeller Interface to view your data.</p>
<ol class="upperalpha simple">
<li><p>Set the project coordinate system to EPSG:32612 (UTM zone 12N) in the bottom right of your window. If you are asked to choose a conversion, select a conversion that is valid for Utah, USA. [1]</p></li>
<li><p>Add the add the DEM via <strong>Layer</strong> &gt; <strong>Add layer</strong> &gt; <strong>Add raster layer</strong>. Now select Mead_DEM.tif from the “raster” folder. [2]</p></li>
<li><p>Repeat the previous step to add the friction raster named Mead_friction.tif, the infiltration raster named Mead_infiltration.tif, and the infiltration capacity raster Mead_infiltration_capacity.tif.</p></li>
</ol>
<p>You can also do this by dragging the .tif files from their folder into the Modeller Interface screen.</p>
<figure class="align-default" id="id1">
<img alt="Load layers" src="_images/03_load_layers.png" />
<figcaption>
<p><span class="caption-number">Fig. 33 </span><span class="caption-text">Empty LP_burrows.sqlite and DEM loaded into the 3Di Modeller Interface and projected on a google satellite background map.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="model-building">
<h2>Model building<a class="headerlink" href="#model-building" title="Permalink to this heading"></a></h2>
<section id="set-the-model-name">
<h3>Set the model name<a class="headerlink" href="#set-the-model-name" title="Permalink to this heading"></a></h3>
<p>As a first step, let us set the name for the model.
This is contained in the global settings table.
Rename the model via the following steps</p>
<ol class="upperalpha simple">
<li><p>Right-click the v2_global_settings table. [1]</p></li>
<li><p>Select <strong>Open attribute table</strong>. [2]</p></li>
</ol>
<figure class="align-default">
<img alt="Global settings attribute table" src="_images/04_global_settings.png" />
</figure>
<ol class="upperalpha simple" start="3">
<li><p>Select <strong>Switch to form view</strong> in the bottom right corner. [1]</p></li>
<li><p>Select <strong>Toggle editing mode</strong> in the top left corner. [2]</p></li>
<li><p>Set the name to “Tutorial_2D_slope”. [3]</p></li>
</ol>
<figure class="align-default">
<img alt="Global settings set name" src="_images/05_global_settings.png" />
</figure>
<p>This name will be displayed in the 3Di Live Site, once you start a simulation.
Keep the global settings open on editing mode for the next step.</p>
</section>
<section id="add-rasters-to-the-model">
<h3>Add rasters to the model<a class="headerlink" href="#add-rasters-to-the-model" title="Permalink to this heading"></a></h3>
<p>This tutorial includes four rasters: the digital elevation model (DEM), the friction raster, and the infiltration rasters.</p>
<p>The DEM is mandatory for every model.
The friction and infiltration rasters are among the most commonly used data sets for 3Di models.
The friction raster controls the bottom resistance of the bottom to the flow.
The infiltration raster controls the infiltration rate of surface water into the soil.
Finally, the infiltration capacity raster sets the capacity of the soil to store water.</p>
<p>The DEM and the friction raster must be added through the global settings, contained in the v2_global_settings table.
Continue to modify this table.</p>
<ol class="upperalpha simple">
<li><p>Select the tab <strong>Terrain information</strong>. [1]</p></li>
<li><p>Add the DEM file by adding “raster/Mead_DEM.tif” to the field “dem_file”. The part “raster/” is a relative path with respect to the .sqlite. It denotes that the DEM is stored in the raster folder. [2]</p></li>
<li><p>Set the epsg_code to “32612”. [3]</p></li>
<li><p>Add the friction file by adding “raster/Mead_friction.tif” to the field “frict_coef_file”. [4]</p></li>
<li><p>Set the frict_coef to 0. This global value will not be used in the model, as we have defined a spatially varying friction raster for the full domain. [5]</p></li>
<li><p>The coefficients in the friction raster are Manning coefficients. Check that this matches the field “frict_type”. [6]</p></li>
<li><p>Unselect <strong>Toggle editing mode</strong> in the top left corner (see [2] in the image above), and <strong>save</strong> changes. You can now close the pop-up window.</p></li>
</ol>
<img alt="Modify terrain information" src="_images/06_terrain_rasters.png" />
<p>The infiltration raster and infiltration capacity raster control the spatially varying infiltration rate in mm/day and the maximum infiltration capacity in mm respectively for each grid cell.
They are added to the model via the infiltration settings, which are contained in the v2_simple_infiltration table.</p>
<ol class="upperalpha simple">
<li><p>Right-click the v2_simple_infiltration table. [1]</p></li>
<li><p>Select <strong>Open attribute table</strong>.</p></li>
<li><p>Select <strong>Switch to form view</strong>. [2]</p></li>
<li><p>Select <strong>Toggle editing mode</strong>. [3]</p></li>
<li><p>Add the infiltration raster by adding “raster/Mead_infiltration.tif” to the field “infiltration_rate_file”. [4]</p></li>
<li><p>Add the infiltration capacity raster by adding “raster/Mead_infiltration_capacity.tif” to the field “max_infiltration_capacity_file”. [5]</p></li>
<li><p>Set the infiltration rate to 0. This global infiltration rate is overwritten by the spatially varying infiltration raster. [6]</p></li>
<li><p>Unselect <strong>Toggle editing mode</strong>, and <strong>save</strong> changes. You can now close the pop-up window.</p></li>
</ol>
<img alt="Adding infiltration" src="_images/07_infiltration_rasters.png" />
<p>You now have a model with a spatially varying elevation, friction, and infiltration, but the model settings are representative for flat areas.</p>
</section>
<section id="modify-the-settings-for-mountain-environments">
<h3>Modify the settings for mountain environments<a class="headerlink" href="#modify-the-settings-for-mountain-environments" title="Permalink to this heading"></a></h3>
<p>3Di must be configured differently for areas with steep slopes than for flat areas,
due to the strong variations in water level that may occur within a grid cell (see <a class="reference internal" href="h_numerics.html#limiters"><span class="std std-ref">Limiters</span></a>  for a technical description).
We will modify the settings file, which was created for a flat area, such that it can be applied to sloping areas instead.
Here we will only discuss the settings that must be changed.
A full overview of all settings can be found at <a class="reference download internal" download="" href="_downloads/84a660f75b3e8f891f1cd6c5f0b550f8/database-overview.pdf"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">database</span> <span class="pre">overview</span></code></a></p>
<p>First, we will set the numerical settings. Modify the numerical settings via the v2_numerical_settings table.</p>
<ol class="upperalpha simple">
<li><p>Right-click the v2_numerical_settings table.</p></li>
<li><p>Select <strong>Open attribute table</strong>.</p></li>
<li><p>Select <strong>Switch to form view</strong>. [1]</p></li>
<li><p>Select <strong>Toggle editing mode</strong>. [2]</p></li>
<li><p>Select the tab “Limiters”. [3]</p></li>
<li><p>Set the limiter values as in the table below. [4]</p></li>
</ol>
<table class="docutils align-default" id="id2">
<caption><span class="caption-number">Table 17 </span><span class="caption-text">Limiters</span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Setting</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>limiter_grad_1d</p></td>
<td><p>1</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>limiter_grad_2d</p></td>
<td><p>0</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>limiter_slope_crossectional_area_2d</p></td>
<td><p>3</p></td>
<td><p>For sloped areas</p></td>
</tr>
<tr class="row-odd"><td><p>limiter_slope_friction_2d</p></td>
<td><p>1</p></td>
<td><p>For sloped areas</p></td>
</tr>
</tbody>
</table>
<img alt="Setting numerical limiters" src="_images/08_numerical1.png" />
<ol class="upperalpha simple" start="7">
<li><p>Select the tab “Thresholds”</p></li>
<li><p>Set the thin_water_layer_definition to 0.3. This value is in meters.</p></li>
<li><p>Select the tab “Miscellaneous”</p></li>
<li><p>Set the frict_shallow_water_correction to 3.</p></li>
</ol>
<p>Second, we will change how infiltration is computed in the model.
In flat areas, infiltration is typically computed in the wet subgrid cells only.
This method does not work in mountainous terrain, where the elevation differences within a cell are large.
Therefore, the infiltration will be computed over the whole surface.
This is implemented through the “infiltration_surface_option”.
Documentation on the infiltration settings can be found at <a class="reference internal" href="g_infiltration.html#infiltration"><span class="std std-ref">Infiltration</span></a>.</p>
<ol class="upperalpha simple">
<li><p>Right-click the v2_simple_infiltration table.</p></li>
<li><p>Select <strong>Open attribute table</strong>.</p></li>
<li><p>Select <strong>Switch to form view</strong>. [1]</p></li>
<li><p>Select <strong>Toggle editing mode</strong>. [2]</p></li>
<li><p>Set the infiltration_surface_option to 1. [3]</p></li>
</ol>
<img alt="Setting infiltration options" src="_images/09_infiltration.png" />
</section>
<section id="complete-the-location-specific-settings">
<h3>Complete the location-specific settings<a class="headerlink" href="#complete-the-location-specific-settings" title="Permalink to this heading"></a></h3>
<p>Lake Made is a large lake with an area of 640 km2 at maximum capacity.
This leads to an extensive model domain of approximately 90 by 110 km.
The grid and the output settings are adjusted to account for the large model domain.
The initial water level will also be modified to match the elevation of the lake.</p>
<p>First, we will set the grid cell size and the table step size to improve the calculation speed of the model.
The grid cell size will be set to 400 m in accordance with the large domain.
The table step size controls at which vertical resolution properties (other than elevation) are translated from the subgrid domain to the computational domain.
A table step size of 10 m is selected for this model. This is very coarse for a typical 3Di model, but it is justified here due to the large elevation differences at the subgrid level.
Both properties are part of the global settings.</p>
<ol class="upperalpha simple">
<li><p>Right-click the v2_global_settings table.</p></li>
<li><p>Select <strong>Open attribute table</strong>.</p></li>
<li><p>Select <strong>Switch to form view</strong>. [1]</p></li>
<li><p>Select <strong>Toggle editing mode</strong>. [2]</p></li>
<li><p>Select the tab “Grid”. [3]</p></li>
<li><p>Set the grid_space to 400. This value is in meters. [4]</p></li>
<li><p>Set the table_step_size to 10.  This value is in meters. [5]</p></li>
<li><p>Keep the global settings table open.</p></li>
</ol>
<img alt="Changing grid settings" src="_images/10_grid_settings.png" />
<p>According to our elevation map, Lake Mead is located at around 340m above sea level.
The deepest point of Lake Mead has a depth of 160 m at full capacity.
Therefore, we set the initial water level at 500m.</p>
<ol class="upperalpha simple">
<li><p>Select the tab “Terrain Information”.</p></li>
<li><p>Set the initial_waterlevel to 500. This value is in meters.</p></li>
<li><p>Keep the global settings table open</p></li>
</ol>
<p>The discharge of precipitation into Lake Mead takes a long time due to the large model domain.
The number of time steps and the time between model outputs is increased to reflect the slow time scale.
More time steps and a larger output time step are selected to account for the slower drainage.</p>
<ol class="upperalpha simple">
<li><p>Select the tab “Time”.</p></li>
<li><p>Set the nr_timesteps to 1440. This amounts to a model duration of 12 h, as the time step is 30 s.</p></li>
<li><p>Set the output_time_step to 900.  This value is in seconds.</p></li>
<li><p>Save you changes.</p></li>
</ol>
<p>The aggregation time step is also set to 900 s. This has already been set correctly in your .sqlite.</p>
<p>With the completion of the location-specific settings, we have built a basic working 2D flow model for mountainous terrain.</p>
</section>
</section>
<section id="model-validation">
<h2>Model validation<a class="headerlink" href="#model-validation" title="Permalink to this heading"></a></h2>
<p>A short description of the model validation is given here.
A comprehensive guide with visual support is provided in Tutorial 1 (<span class="xref std std-ref">post_processing</span>) and for a general guide see <a class="reference internal" href="i_checking_schematisations.html#checking-model"><span class="std std-ref">Checking the schematisation</span></a>.</p>
<section id="verify-the-model-rasters-using-the-raster-checker">
<h3>Verify the model rasters using the raster checker<a class="headerlink" href="#verify-the-model-rasters-using-the-raster-checker" title="Permalink to this heading"></a></h3>
<p>Before sending our model to the web portal, it is important to validate that our model contains no errors.
The raster checker is part of the 3Di toolbox and performs 18 checks to verify the quality of the DEM.
The raster checker checks all the rasters that are included in the model.
These are the DEM, the friction raster, the infiltration raster and the infiltration capacity raster.
In order to use the raster checker, follow these steps:</p>
<ol class="upperalpha simple">
<li><p>Select the <strong>commands for working with 3Di models</strong> button. On the right of your screen, a tab “3Di” will open. [1]</p></li>
<li><p>Expand the “Step 1 – Check data” line and click on the <strong>raster checker</strong>. [2]</p></li>
<li><p>In the pop-up screen, select ‘spatialite: Lake_Mead’ and click <strong>OK</strong>. [3]</p></li>
</ol>
<img alt="Raster checker in action" src="_images/11_raster_checker.png" />
<p>The following screen will appear:</p>
<img alt="Raster checker result" src="_images/12_raster_result.png" />
</section>
<section id="verify-the-schematisation-using-the-schematisation-checker">
<h3>Verify the schematisation using the schematisation checker<a class="headerlink" href="#verify-the-schematisation-using-the-schematisation-checker" title="Permalink to this heading"></a></h3>
<p>The second validation that we have to perform before sending the model to the web portal is that of the schematisation.
For this, we use the schematisation checker.
It checks the model tables for many possible errors that cause the model to crash when you want to compile the model.
In order to check your schematisation, follow steps a and b from the previous step, but now select <strong>schematisation checker</strong>.
Again, select ‘spatialite:Lake_Mead’ and select the destination for the output file.
Select <strong>Run</strong>.</p>
<p>The output file is an excel file in which all the warnings and errors that were found are listed.
You may get the error “Value in v2_aggregation_settings.aggregation_in_space should be of the type integer”.
This is a known error in the schematisation checker, which will be removed in a future update.
If you get this error, you can ignore it.</p>
<p>If you do not get any further warnings or errors, your model is successfully validated and is ready to upload to the web portal.</p>
</section>
</section>
<section id="model-activation">
<h2>Model activation<a class="headerlink" href="#model-activation" title="Permalink to this heading"></a></h2>
<p>A short description of the model activation is given here. A comprehensive guidance with visual support is provided in Tutorial 2 (<a class="reference internal" href="e_2d_tutorial.html#tutorial2-2dflatmodel"><span class="std std-ref">Tutorial 2: Building a Basic 2D Flow Schematisation</span></a>).</p>
<section id="upload-your-model">
<h3>Upload your model<a class="headerlink" href="#upload-your-model" title="Permalink to this heading"></a></h3>
<p>See <a class="reference internal" href="e_klondike_workflow.html#uploading-schematisation"><span class="std std-ref">Uploading the Schematisation</span></a> for how to upload your model.</p>
<p>The model is now also available on the <a class="reference external" href="https://www.3di.live/">3Di Livesite</a> and the <a class="reference external" href="https://management.3di.live">management screens</a>.</p>
</section>
<section id="run-your-model">
<h3>Run your model<a class="headerlink" href="#run-your-model" title="Permalink to this heading"></a></h3>
<p>You have now build a 2D flow model for mountainous terrain from scratch!
You can now run your model via the 3Di Live Site (<a class="reference internal" href="c_what_is_the_live_site.html#guide-to-portal"><span class="std std-ref">Technical setup</span></a>) or via the 3Di Modeller Interface (<a class="reference internal" href="i_running_a_simulation.html#simulate-api-qgis"><span class="std std-ref">Running a simulation</span></a>).
It will be available under the name you gave it.</p>
<figure class="align-default" id="id3">
<img alt="_images/13_compiled_model.png" src="_images/13_compiled_model.png" />
<figcaption>
<p><span class="caption-number">Fig. 34 </span><span class="caption-text">The final model on the 3Di live site. The initial water level can be seen in dark blue through the grid.</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="e_2d_tutorial.html" class="btn btn-neutral float-left" title="Tutorial 2: Building a Basic 2D Flow Schematisation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="e_2d_levees_tutorial.html" class="btn btn-neutral float-right" title="Tutorial 4 Building a 2D flow model with levees, channels and breaches" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Nelen &amp; Schuurmans.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>