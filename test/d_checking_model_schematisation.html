<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checking the model schematisation &mdash; 3Di  (dev doc 2023-02-13) documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/matomo.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding scenario information and running a simulation" href="d_adding_running_scenario.html" />
    <link rel="prev" title="Boundary Conditions" href="d_boundary_conditions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            3Di
          </a>
              <div class="version">
                 (dev doc 2023-02-13)
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="a_background.html">Background of 3Di</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_ecosystem.html">3Di Ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_modelling_concepts.html">Basic Modelling Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_releasenotes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_contact.html">Contact</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">3Di Connectors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="b_fews_3di_integrations.html">FEWS-3Di integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide to the 3Di Live Site</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="c_threedi_portal.html">Login to the Live Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_threedi_portal.html#start-or-follow-a-session">Start or follow a session</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_threedi_portal.html#overview-session-screen-and-tooling">Overview session screen and tooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_threedi_portal.html#quitting-the-simulation">Quitting the simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_threedi_portal.html#store-results">Store results</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_threedi_portal.html#notables">Notables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How to work with 3Di</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="d_building_a_model.html">Building and editing a model schematisation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Checking the model schematisation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#toolbox-for-working-with-3di-models">Toolbox for working with 3Di models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#raster-checker">Raster checker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schematisation-checker">Schematisation checker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="d_adding_running_scenario.html">Adding scenario information and running a simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="d_viewing_analysing_results.html">Storing, viewing and analysing results</a></li>
<li class="toctree-l1"><a class="reference internal" href="d_management.html">Manage your schematisations and models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="e_klondike_workflow.html">Tutorial 1: Workflow of creating a 3Di Schematisation and a 3Di Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_2d_tutorial.html">Tutorial 2: Building a Basic 2D Flow Schematisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_2d_slope_tutorial.html">Tutorial 3: 2D flow model over sloped terrain with multiple rasters</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_2d_levees_tutorial.html">Tutorial 4 Building a 2D flow model with levees, channels and breaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_1d_tutorial.html">Tutorial 5: Building a 1D model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Problem solving and support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="f_3di_instruments_and_downloads.html">Installation manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="f_problem_solving.html">FAQ and Problem Solving</a></li>
<li class="toctree-l1"><a class="reference internal" href="f_servicedesk.html">Servicedesk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="g_massconservation.html">Conservation of mass</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_sources_sinks.html">Source and Sink terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_levees_obstacles_breaches.html">Obstacles, Levees and Breaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_wind.html">Wind effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_interception.html">Interception</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="h_basic_modelling_concepts_threedi.html">Basic Modelling Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_grid.html">The grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_numerics.html">Numerics</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_control.html">Control Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_calculation_grid_data.html">Tabulated data storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_results.html">Results 3Di</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_aggregate_results.html">Aggregated output</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_state_files.html">State files</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">3Di</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Checking the model schematisation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/d_checking_model_schematisation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="checking-the-model-schematisation">
<span id="checking-model"></span><h1>Checking the model schematisation<a class="headerlink" href="#checking-the-model-schematisation" title="Permalink to this heading"></a></h1>
<p>It is very useful to check your model schematisation before uploading. It can raise errors and let you solve them early on, or it can raise warnings, which you might want to solve.</p>
<p><em>Checking the model schematisation can only be done with toolboxes in QGIS designed for 3Di models, which come pre-installed with the Modeller Interface.
For information how to download the Modeller Interface or the seperate plugins, please visit</em> <a class="reference internal" href="f_3di_instruments_and_downloads.html#di-instruments-and-downloads"><span class="std std-ref">Installation manual</span></a>.</p>
<section id="toolbox-for-working-with-3di-models">
<span id="ditoolbox"></span><h2>Toolbox for working with 3Di models<a class="headerlink" href="#toolbox-for-working-with-3di-models" title="Permalink to this heading"></a></h2>
<p>The 3Di toolbox is actived by clicking the toolbox icon in the 3Di-Toolbox bar.</p>
<figure class="align-default">
<img alt="3Di Toolbox Bar" src="_images/d_qgisplugin_activate_toolbox.png" />
</figure>
<p>After clicking the toolbox icon, a new window is opened. Click the arrow next to the <em>Tools</em> icon to open the toolbox and view the different tools that are available.</p>
<figure class="align-default">
<img alt="Toolbox Window" src="_images/d_qgisplugin_toolbox_window.png" />
</figure>
</section>
<section id="raster-checker">
<span id="rasterchecker"></span><h2>Raster checker<a class="headerlink" href="#raster-checker" title="Permalink to this heading"></a></h2>
<p>The <em>Raster checker</em> is launched since the QGIS 3.4.5 version of the Plugin and now available for the LTR version. This tool checks the rasters for your 3Di model schematisation. The tool verifies for example:</p>
<ul class="simple">
<li><p>The correct nodata value</p></li>
<li><p>Consistent projection between rasters</p></li>
<li><p>Alignment of all rasters</p></li>
</ul>
<p>The principe of the raster checker is to check if your model will calculate. It does not validate on logical values and if elements are connected.</p>
<p>The RasterChecker checks your rasters based on the raster references in your sqlite.
This is done for all v2_global_setting rows.</p>
<p><strong>The following checks are executed:</strong></p>
<p>– Per individual raster: –</p>
<ul class="simple">
<li><p>1: Are all filenames of rasters within one setting_id unique? (3Di can handle this, but the RasterChecker not).</p></li>
<li><p>2: Do the referenced rasters (in all v2_tables) exist on your machine?</p></li>
<li><p>3: Is the raster file extension .tif / .tiff?</p></li>
<li><p>4: Is the raster filename valid? (no special characters, no space, max one ‘.’ and ‘/’)</p></li>
<li><p>5: Is the raster single- (not multi-) band?</p></li>
<li><p>6: Is the raster nodata value -9999?</p></li>
<li><p>7: Does the raster have a projected coordinate system (unit: meters)?</p></li>
<li><p>8: Is the raster data type float 32?</p></li>
<li><p>9: Is the raster compressed? (compression=deflate)</p></li>
<li><p>10: Does the pixelsize have max three decimal places?</p></li>
<li><p>11: Are the pixels square?</p></li>
<li><p>12: Are there no extreme pixel values? (dem: -10kmMSL&lt;x&lt;10kmMSL, other rasters have their own limits</p></li>
</ul>
<p>– All rasters per setting_id at once: –</p>
<ul class="simple">
<li><p>13: Is the cumulative number of pixels of all rasters per setting_id lower than 1.000.000.000?</p></li>
</ul>
<p>– Raster comparison: –</p>
<ul class="simple">
<li><p>14: Is the projection equal to the dem projection?</p></li>
<li><p>15: Is the pixel size equal to the dem pixel size?</p></li>
<li><p>16: Is the number of data/nodata pixels equal to the dem.</p></li>
<li><p>17: Is the number of rows-colums equal to the dem?</p></li>
</ul>
<p>– Pixel allignment: –</p>
<ul class="simple">
<li><p>18: Are pixels correctly aligned (data and nodata locations) with the dem?</p></li>
</ul>
<p><strong>How to use the raster checker?</strong></p>
<p>To use the <em>Raster checker</em>, set up a connection with the SQlite of your model.</p>
<ol class="arabic simple">
<li><p>Open the <em>Data Source Manager</em> under the drop down menu <em>Layer</em> on top of the screen.</p></li>
<li><p>Go to <em>SpatiaLite</em> and click <em>New</em>. Browse to the location of your model Sqlite and open it.</p></li>
<li><p>Now you can close the <em>Data Source Manager</em> window.</p></li>
</ol>
<figure class="align-default">
<img alt="Data Source Manager" src="_images/d_qgisplugin_load_sqlite.png" />
</figure>
<ol class="arabic simple" start="4">
<li><p>The <em>Raster checker</em> can be accessed by opening the Toolbox.</p></li>
<li><p>The <em>Raster checker</em> can be found under <em>Step 1 - Check data</em>. By double clicking <em>raster_checker.py</em> the <em>Raster checker</em> is opened in a seperate window.</p></li>
</ol>
<figure class="align-default">
<img alt="Data Source Manager" src="_images/d_qgisplugin_activate_rasterchecker.png" />
</figure>
<ol class="arabic simple" start="6">
<li><p>Under <em>Model schematisation database</em> you can choose the spatialite of your model.</p></li>
<li><p>Click <em>OK</em> to start the <em>raster checker</em>. When the tool is finished the following message pops-up:</p></li>
</ol>
<figure class="align-default">
<img alt="Raster checker Done" src="_images/d_qgisplugin_rasterchecker_done.png" />
</figure>
<ol class="arabic simple" start="8">
<li><p>The log-file of the raster checker can be found at the same location as the location of the SQlite. The log-file can be opened with a text editor such as Notepad. The log-file looks similar to:</p></li>
</ol>
<figure class="align-default">
<img alt="Rasterchecker Done" src="_images/d_qgisplugin_rasterchecker_log_header.png" />
</figure>
<p>Here, one can also find the overview of the 18 checks that are performed.</p>
<ol class="arabic simple" start="9">
<li><p>The performed checks are numbered 1 to 18. This number is called a <em>check_id</em>.</p></li>
<li><p>Under sub-heading <em>Found following raster references</em>, there is a list with the rasters used in your model schematisation.</p></li>
</ol>
<p>Further down in the log-file, the outcome of the <em>raster checker</em> for each raster is shown.</p>
<figure class="align-default">
<img alt="Rasterchecker Feedback" src="_images/d_qgisplugin_rasterchecker_log_checks.png" />
</figure>
<ol class="arabic simple" start="11">
<li><p>The first column, named <em>level</em>, shows the importance of the notification (info, warning or error). Errors need to be solved.</p></li>
<li><p>The second column, named <em>setting_id</em>, refers to the id of the row in the v2_global_settings table of the sqlite, where the raster reference can be found.</p></li>
<li><p>The third column contains the <em>check_id</em>.</p></li>
<li><p>The fourth column is the <em>feedback</em>, it contains the outcome of the specific verification check.</p></li>
<li><p>If one of your rasters is not aligned with the DEM (bathymetry file), check_id 18 will give an error. Make sure all your rasters have the same extent and and have nodata pixels at the same location.</p></li>
</ol>
</section>
<section id="schematisation-checker">
<span id="schematisationchecker"></span><h2>Schematisation checker<a class="headerlink" href="#schematisation-checker" title="Permalink to this heading"></a></h2>
<p>The <em>schematisation checker</em> analyses your 3Di model database (.sqlite file) for completeness and consistency between tables.
With the checker you can make sure most database errors are found before sending the model to the 3Di servers for model generation.</p>
<p>In order to use the <em>schematisation checker</em> follow these steps:</p>
<ol class="arabic simple">
<li><p>Start the Modeller Interface</p></li>
<li><p>Add a connection to the model database (<em>Layer</em> -&gt; <em>Data Source Manager</em>, Select <em>SpatiaLite</em> on the left and create a <em>‘New’</em> connection or connect to an existing connection)</p></li>
<li><p>Open the <em>schematization checker</em> by opening the <em>Toolbox</em> in the 3Di Plugin, select <em>Step 1: check data</em>, select <em>schematisation_checker.py</em></p></li>
<li><p>Select the SpatiaLite connection of the model database and the location where to store the output of the schematisation checker. Click <em>run</em> to run the schematisation checker. Click <em>open</em> to open the output.</p></li>
</ol>
<p>The output is a comma seperated value file, which can be opened in, for example, Excel. It contains 6 columns: <em>id, table, column, value, description and check</em>:</p>
<ul class="simple">
<li><p><strong>id</strong>: identification number of the row where a check encounters an error.</p></li>
<li><p><strong>table</strong>: the table in which the error occurs.</p></li>
<li><p><strong>column</strong>: the column which contains the error.</p></li>
<li><p><strong>value</strong>: the current value in the cell</p></li>
<li><p><strong>description</strong>: description of the error</p></li>
<li><p><strong>check</strong>: the type of check that found the error, described below</p></li>
</ul>
<p><strong>What is checked?</strong></p>
<p>There are currently different general checks applied on all tables and columns of the model database. These checks are:</p>
<ul class="simple">
<li><p>TypeCheck</p></li>
<li><p>NotNullCheck</p></li>
<li><p>ForeignKeyCheck</p></li>
<li><p>EnumCheck</p></li>
<li><p>UniqueCheck</p></li>
<li><p>GeometryCheck</p></li>
<li><p>GeometryTypeCheck</p></li>
</ul>
<p>Apart from the general checks on the database data and structure there are more 3Di specific checks:</p>
<ul class="simple">
<li><p>BankLevelCheck</p></li>
<li><p>CrossSectionShapeCheck</p></li>
<li><p>TimeSeriesCheck</p></li>
<li><p>Use0DFlowCheck</p></li>
</ul>
<p><strong>TypeCheck</strong> Every cell in every table will be checked if the type of the entered value is correct. A values in cell is expected to be a(n):
- integer (-4, 0,1,2, etc…)
- real (3.6, -5.2)
- text
- varchar (text of limited length)
- geometry (point, linestring or polygon)
- bool (bolean, true or false)
- datetime (2019-07-02 14:27+02:00)</p>
<p><strong>EnumCheck</strong> Some cells expect specific values. For example, the type of a boundary condition is either 1, 2, 3 or 5 (respectively water level, velocity, discharge or Sommerfeld). Any value other than the enumerated values will result in an EnumCheck error.</p>
<p><strong>NotNullCheck</strong> If a cell is <em>NULL</em> it id empty. For some cells this is allowed, but others cells are obliged to contain a value. If this obligation is not met, a NotNullCheck error is given.</p>
<p>n.b. An empty text or varchar does not equal NULL.</p>
<p><strong>ForeignKeyCheck</strong> Many tables contain foreign key columns which refer to other tables. An example is the column <em>connection_node_start_id</em> in the table <em>v2_channel</em>. This column refers to the column <em>id</em> in the table <em>v2_connection_node</em>. If a channel is entered with <em>connection_node_start_id = 1</em>, there should be an entry in the table <em>v2_connection_nodes</em> with <em>id = 1</em>. If this is not the case a ForeignKeyCheck error will be given.</p>
<p><strong>UniqueCheck</strong> Some values have to be unique. An example is the name column in <em>v2_global_settings</em>. If multiple rows are entered with the same name, a UniqueCheck error will be given.</p>
<p><strong>GeometryCheck</strong> If an entered geometry is invalid the GeometryCheck error will be returned. The most occurring reason for invalid geometries is self-intersection of polygons.</p>
<p><strong>GeometryTypeCheck</strong> This check makes sure the geometry type (point, linestring or polygon) is consistent with the expected geometry type.</p>
<p><strong>BankLevelCheck</strong> Check if the row <em>bank_level</em> of <em>v2_cross_section_locations</em> table is not NULL, when the corresponding channel is of the type <em>connected</em> or <em>double_connected</em>.</p>
<p><strong>CrossSectionShapeCheck</strong> Each type of cross-section shape requires certain input. This check verifies if all cross-section shapes are well posed:</p>
<ul class="simple">
<li><p><em>Rectangle</em>: A width is required, a height is optional. The dimensions should be positive decimal numbers.</p></li>
<li><p><em>Circle</em>: Only a “width” is required. This is diameter of the circle and should be a positive decimal number.</p></li>
<li><p><em>Egg</em>: Only a “width” is required. The height is 1.5 times the width. This value should be a positive decimal number.</p></li>
<li><p><em>Tabulated rectangle or trapezium</em>: A list of widths and heights are required. The lists should contain only positive decimal numbers seperated by spaces and contain the same amount of values. The first value of <em>height</em> should always be 0. The height list should be increasing. In case the width is set to 0 m at the heighest increment, the cross-section is closed.</p></li>
</ul>
<p><strong>TimeseriesCheck</strong> This check verifies if time series are correctly defined. It checks whether the time steps in that table are all the same.</p>
<p><strong>Use0DFlowCheck</strong> If 0D flow is configured in the global settings table, there should be at least 1 (impervious) surface defined in the model.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="d_boundary_conditions.html" class="btn btn-neutral float-left" title="Boundary Conditions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="d_adding_running_scenario.html" class="btn btn-neutral float-right" title="Adding scenario information and running a simulation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Nelen &amp; Schuurmans.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>