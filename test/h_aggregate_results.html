<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aggregated output &mdash; 3Di  (dev doc 2023-02-27) documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/matomo.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="State files" href="h_state_files.html" />
    <link rel="prev" title="Results 3Di" href="h_results.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            3Di
          </a>
              <div class="version">
                 (dev doc 2023-02-27)
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="a_background.html">Background of 3Di</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_ecosystem.html">3Di Ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_modelling_concepts.html">Basic Modelling Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_releasenotes.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="a_contact.html">Contact</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">3Di Connectors</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="b_fews_3di_integrations.html">FEWS-3Di integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modelling guidelines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="d_modeling_guidelines.html">Modelling guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide to the 3Di Modeller Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="i_what_is_mi.html">What is the Modeller Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="i_overview_user_interface.html">Overview of the user Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="i_modelling_with_mi.html">Modelling with the Modeller Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guide to the 3Di Live Site</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="c_what_is_the_live_site.html">What is the live site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_what_is_the_live_site.html#using-the-3di-live-site">Using the 3Di Live Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_livesite_overview.html">Overview of the live site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_livesite_overview.html#login-to-the-live-site">Login to the Live Site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_livesite_overview.html#overview-session-screen-and-tooling">Overview session screen and tooling</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_livesite_overview.html#notables">Notables</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_modelling_with_live_site.html">Modelling with the live site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_modelling_with_live_site.html#start-or-follow-a-session">Start or follow a session</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_modelling_with_live_site.html#editing-a-model-schematisation-with-the-live-site">Editing a model schematisation with the live site</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_modelling_with_live_site.html#simulation-interventions">Simulation interventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_modelling_with_live_site.html#analyzing-results-while-scenario-is-running">Analyzing results while scenario is running</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_modelling_with_live_site.html#quitting-the-simulation">Quitting the simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_modelling_with_live_site.html#store-results">Store results</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="e_klondike_workflow.html">Tutorial 1: Workflow of creating a 3Di Schematisation and a 3Di Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_2d_tutorial.html">Tutorial 2: Building a Basic 2D Flow Schematisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_2d_slope_tutorial.html">Tutorial 3: 2D flow model over sloped terrain with multiple rasters</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_2d_levees_tutorial.html">Tutorial 4 Building a 2D flow model with levees, channels and breaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="e_1d_tutorial.html">Tutorial 5: Building a 1D model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Problem solving and support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="f_3di_instruments_and_downloads.html">Installation manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="f_problem_solving.html">FAQ and Problem Solving</a></li>
<li class="toctree-l1"><a class="reference internal" href="f_servicedesk.html">Servicedesk</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Physics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="g_massconservation.html">Conservation of mass</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_flow.html">Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_sources_sinks.html">Source and Sink terms</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_levees_obstacles_breaches.html">Obstacles, Levees and Breaches</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_wind.html">Wind effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="g_interception.html">Interception</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model concepts</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="h_basic_modelling_concepts_threedi.html">Basic Modelling Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_grid.html">The grid</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_numerics.html">Numerics</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_control.html">Control Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_calculation_grid_data.html">Tabulated data storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="h_results.html">Results 3Di</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Aggregated output</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration-options">Configuration options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#var-name">var_name</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flow-variable">flow_variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aggregation-method">aggregation_method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-step">time step</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aggregation-in-space">aggregation_in_space</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#output-format-in-result-file">Output format in result file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#settings-for-water-balance-tool">Settings for water balance tool</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="h_state_files.html">State files</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">3Di</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Aggregated output</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/h_aggregate_results.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="aggregated-output">
<span id="aggregationnetcdf"></span><h1>Aggregated output<a class="headerlink" href="#aggregated-output" title="Permalink to this heading"></a></h1>
<p>Results for a 3Di simulation are written in a results file called <em>results_3di.nc</em> (previously <em>subgrid_map.nc</em>). This file contains the flow information (snap shots) at different times in the simulation. The interval at which this information is written, is defined by the user via the parameter <em>output_time_step</em>.</p>
<p>Aggregated results over certain intervals during the simulation can be very useful. For instance, the aggregated results are the input for the water balance tool in QGIS. For a consistent water balance, the results of various snap shots is not enough in case of an output time step which is larger than the computational time step. For this purpose, an aggregated results file is available called <em>aggregate_ results_3di.nc</em> (previously <em>flow_aggregate.nc</em>). The structure of the file is very similar as the other result file. Each Mesh variable (s1, u1, etc.) described in the results section can be aggregated. The configuration for this aggregation file is available in the models spatialite and the table is called v2_aggregation_settings. The configuration and its options are explained below. The layout of the table is:</p>
<figure class="align-default">
<img alt="Table layout aggregation options" src="_images/aggregation_table.png" />
</figure>
<section id="configuration-options">
<h2>Configuration options<a class="headerlink" href="#configuration-options" title="Permalink to this heading"></a></h2>
<p>In the spatialite a table can be filled to configure variables and their aggregation methods to acquire the desired aggregation results. The possible flow variables and their specific inputs are described along with all the possible aggregation methods. Users can determine multiple aggregation options for each <em>flow_variable</em> as long as the <em>aggregation_method</em> is not used twice for the same flow_variable.</p>
<section id="var-name">
<h3>var_name<a class="headerlink" href="#var-name" title="Permalink to this heading"></a></h3>
<p>A user-defined variable name to distinguish between aggregated configuration of variables for user administration only. This setting is mandatory.</p>
</section>
<section id="flow-variable">
<h3>flow_variable<a class="headerlink" href="#flow-variable" title="Permalink to this heading"></a></h3>
<p>The different flow variable for which to determine aggregated results are. The flow variables for input to generate aggregated results are:</p>
<ul class="simple">
<li><p>waterlevel</p></li>
<li><p>flow_velocity</p></li>
<li><p>discharge</p></li>
<li><p>volume</p></li>
<li><p>pump_discharge</p></li>
<li><p>wet_cross-section</p></li>
<li><p>lateral_discharge</p></li>
<li><p>wet_surface</p></li>
<li><p>rain</p></li>
<li><p>simple_infiltration</p></li>
<li><p>leakage</p></li>
<li><p>interception</p></li>
<li><p>surface_source_sink_discharge</p></li>
</ul>
</section>
<section id="aggregation-method">
<h3>aggregation_method<a class="headerlink" href="#aggregation-method" title="Permalink to this heading"></a></h3>
<p>The different aggregation methods that can be used on a flow variable are:</p>
<ul class="simple">
<li><p>max: maximum value of the variable in the configured interval (time step).</p></li>
<li><p>min: minimum value of the variable in the configured interval (time step).</p></li>
<li><p>avg: average value of the variable in the configured interval (time step).</p></li>
<li><p>cum: This is integration over time of the variable [dt * variable]. For instance, the cumulative net discharge across a flow line in the configured interval.</p></li>
<li><p>cum_positive: This is integration over time of the variable [dt * variable] in positive direction. For instance, the cumulative net discharge in positive direction across a flow line in the configured interval.</p></li>
<li><p>cum_negative: This is integration over time of the variable [dt * variable] in negative direction. For instance, the cumulative net discharge in negative direction across a flow line in the configured interval.</p></li>
<li><p>current: Uses the current value of a variable. This is required in case one checks the water balance for variables that are the result of the processes. This is a setting only valid for <em>volume</em> and <em>intercepted_volume</em>.</p></li>
</ul>
</section>
<section id="time-step">
<h3>time step<a class="headerlink" href="#time-step" title="Permalink to this heading"></a></h3>
<p>Time step is the interval in seconds for writing and determining the aggregated flow results. In the example above, the maximum water level is determined over every 600 seconds. The minimum water level is determined over a period ov 500 seconds.</p>
</section>
<section id="aggregation-in-space">
<h3>aggregation_in_space<a class="headerlink" href="#aggregation-in-space" title="Permalink to this heading"></a></h3>
<p>This setting is not yet implemented and is therefore always <em>False</em>.</p>
</section>
</section>
<section id="output-format-in-result-file">
<h2>Output format in result file<a class="headerlink" href="#output-format-in-result-file" title="Permalink to this heading"></a></h2>
<p>The variable name of the aggregated flow results in the <em>aggregate_ results_3di.nc</em> are named based on the chosen flow variable and the chosen aggregation method:</p>
<p>The flow variable chosen in the flow_variable field is converted to the flow_variable naming of threedi concatenated with the aggregation method. This convention look like this:
&lt;threedi_flow_variable&gt;_&lt;aggregation _method&gt;
Every aggregated results has it’s own time variable in the aggregated result file at which the aggregated flow results were written. This variable will be named based on the following convention:
time_&lt;aggregation_variable&gt;</p>
<p>The translation between the input flow variable name and the format in the the output file is given in the table below:</p>
<ul class="simple">
<li><p>waterlevel - s1</p></li>
<li><p>flow_velocity - u1</p></li>
<li><p>discharge - q</p></li>
<li><p>volume - vol</p></li>
<li><p>pump_discharge - q_pump</p></li>
<li><p>wet_cross-section - au</p></li>
<li><p>lateral_discharge - q_lat</p></li>
<li><p>wet_surface - su</p></li>
<li><p>rain - rain</p></li>
<li><p>simple_infiltration - infiltration_rate_simple</p></li>
<li><p>leakage - leak</p></li>
<li><p>interception - intercepted_volume</p></li>
<li><p>surface_source_sink_discharge - q_sss</p></li>
</ul>
<p>An example of the output name is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">flow_variable</span><span class="p">:</span> <span class="n">s1</span>
<span class="n">aggregation_method</span><span class="p">:</span> <span class="nb">max</span>
<span class="n">output_name</span><span class="p">:</span> <span class="n">Mesh2D_s1_max</span> <span class="ow">and</span> <span class="n">Mesh1D_s1_max</span>
<span class="n">time_name</span><span class="p">:</span> <span class="n">time_s1_max</span>
</pre></div>
</div>
</section>
<section id="settings-for-water-balance-tool">
<h2>Settings for water balance tool<a class="headerlink" href="#settings-for-water-balance-tool" title="Permalink to this heading"></a></h2>
<p>To use the water balance tool in the 3Di QGIS plugin you must set a specific set of aggregation settings. These settings are listed under <a class="reference internal" href="i_analyzing_results.html#waterbalanceactivate"><span class="std std-ref">Settings to use the water balance tool</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="h_results.html" class="btn btn-neutral float-left" title="Results 3Di" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="h_state_files.html" class="btn btn-neutral float-right" title="State files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Nelen &amp; Schuurmans.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>